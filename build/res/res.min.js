var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},__define=this.__define||function(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r,set:i})},RES;!function(e){var t=function(t){function r(){t.call(this),this.resourceConfig=null,this.resourceConfig=e.configInstance}__extends(r,t);var i=r;return p=i.prototype,p.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},p.loadFile=function(){},p.getRes=function(){},p.destroyRes=function(){return!1},r.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(0,t):""},r.getStringTail=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(t+1):""},r}(egret.HashObject);e.AnalyzerBase=t,egret.registerClass(t,"RES.AnalyzerBase")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this.fileDic={},this.resItemDic=[],this._dataFormat=egret.URLLoaderDataFormat.BINARY,this.recycler=new egret.Recycler}__extends(t,e);var r=t;return p=r.prototype,p.loadFile=function(e,t,r){if(this.fileDic[e.name])return void t.call(r,e);var i=this.getLoader();this.resItemDic[i.hashCode]={item:e,func:t,thisObject:r},i.load(new egret.URLRequest(e.url))},p.getLoader=function(){var e=this.recycler.pop();return e||(e=new egret.URLLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e.dataFormat=this._dataFormat,e},p.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,a=r.func;i.loaded=e.type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t.data),this.recycler.push(t),a.call(r.thisObject,i)},p.analyzeData=function(e,t){var r=e.name;!this.fileDic[r]&&t&&(this.fileDic[r]=t)},p.getRes=function(e){return this.fileDic[e]},p.hasRes=function(e){var t=this.getRes(e);return null!=t},p.destroyRes=function(e){return this.fileDic[e]?(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0):!1},p.onResourceDestroy=function(){},t}(e.AnalyzerBase);e.BinAnalyzer=t,egret.registerClass(t,"RES.BinAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.textureMap={},this._dataFormat=egret.URLLoaderDataFormat.TEXT}__extends(r,t);var i=r;return p=i.prototype,p.getRes=function(t){var r=this.fileDic[t];if(r||(r=this.textureMap[t]),!r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.fileDic[i]){var a=e.AnalyzerBase.getStringTail(t);r=r.getTexture(a)}}return r},p.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,a=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if("string"==typeof t.data){i.loaded=!1;var s=this.analyzeConfig(i,t.data);if(s){var n=i.url;return i.url=s,this._dataFormat=egret.URLLoaderDataFormat.TEXTURE,this.loadFile(i,a,r.thisObject),this._dataFormat=egret.URLLoaderDataFormat.TEXT,void(i.url=n)}}else this.analyzeBitmap(i,t.data);this.recycler.push(t),a.call(r.thisObject,i)},p.analyzeConfig=function(e,t){var r,i=e.name,a="";try{var s=t;r=JSON.parse(s)}catch(n){egret.$warn(1017,e.url,t)}return r&&(this.sheetMap[i]=r,a=this.getRelativePath(e.url,r.file)),a},p.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var a=e.data&&e.data.subkeys?"":r,s=this.parseSpriteSheet(t,i,a);this.fileDic[r]=s}},p.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.lastIndexOf("/");return e=-1!=r?e.substring(0,r+1)+t:t},p.parseSpriteSheet=function(e,t,r){var i=t.frames;if(!i)return null;var a=new egret.SpriteSheet(e),s=this.textureMap;for(var n in i){var o=i[n],e=a.createTexture(n,o.x,o.y,o.w,o.h,o.offX,o.offY,o.sourceW,o.sourceH);if(o.scale9grid){var u=o.scale9grid,c=u.split(",");e.scale9Grid=new egret.Rectangle(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),parseInt(c[3]))}null==s[n]&&(s[n]=e,r&&this.addSubkey(n,r))}return a},p.destroyRes=function(e){var t=this.fileDic[e];if(t){delete this.fileDic[e];for(var r in t._textureMap)this.textureMap[r]&&delete this.textureMap[r];return this.onResourceDestroy(t),!0}return!1},p.onResourceDestroy=function(e){e.dispose()},r}(e.BinAnalyzer);e.SheetAnalyzer=t,egret.registerClass(t,"RES.SheetAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var r=t;return p=r.prototype,p.analyzeConfig=function(e,t){var r,i=e.name,a="";try{var s=t;r=JSON.parse(s)}catch(n){}return r?a=this.getRelativePath(e.url,r.file):(r=t,a=this.getTexturePath(e.url,r)),this.sheetMap[i]=r,a},p.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=t,a=this.sheetMap[r];delete this.sheetMap[r];var s=new egret.BitmapFont(i,a);this.fileDic[r]=s}},p.getTexturePath=function(e,t){var r="",i=t.split("\n"),a=i[2],s=a.indexOf('file="');-1!=s&&(a=a.substring(s+6),s=a.indexOf('"'),r=a.substring(0,s)),e=e.split("\\").join("/");var s=e.lastIndexOf("/");return e=-1!=s?e.substring(0,s+1)+r:r},p.onResourceDestroy=function(e){e.dispose()},t}(e.SheetAnalyzer);e.FontAnalyzer=t,egret.registerClass(t,"RES.FontAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.URLLoaderDataFormat.TEXTURE}__extends(t,e);var r=t;return p=r.prototype,p.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;if(i&&i.scale9grid){var a=i.scale9grid,s=a.split(",");t.scale9Grid=new egret.Rectangle(parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3]))}}},p.onResourceDestroy=function(e){e.dispose()},t}(e.BinAnalyzer);e.ImageAnalyzer=t,egret.registerClass(t,"RES.ImageAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.URLLoaderDataFormat.TEXT}__extends(t,e);var r=t;return p=r.prototype,p.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t;this.fileDic[r]=JSON.parse(i)}catch(a){egret.$warn(1017,e.url,t)}},t}(e.BinAnalyzer);e.JsonAnalyzer=t,egret.registerClass(t,"RES.JsonAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.URLLoaderDataFormat.SOUND}__extends(t,e);var r=t;return p=r.prototype,p.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;i&&i.soundType}},t}(e.BinAnalyzer);e.SoundAnalyzer=t,egret.registerClass(t,"RES.SoundAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.URLLoaderDataFormat.TEXT}__extends(t,e);var r=t;return p=r.prototype,t}(e.BinAnalyzer);e.TextAnalyzer=t,egret.registerClass(t,"RES.TextAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.URLLoaderDataFormat.TEXT}__extends(t,e);var r=t;return p=r.prototype,p.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t,a=egret.XML.parse(i);this.fileDic[r]=a}catch(s){}},t}(e.BinAnalyzer);e.XMLAnalyzer=t,egret.registerClass(t,"RES.XMLAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){this.keyMap={},this.groupDic={},e.configInstance=this}var r=t;return p=r.prototype,p.getGroupByName=function(e){var t=new Array;if(!this.groupDic[e])return t;for(var r=this.groupDic[e],i=r.length,a=0;i>a;a++){var s=r[a];t.push(this.parseResourceItem(s))}return t},p.getRawGroupByName=function(e){return this.groupDic[e]?this.groupDic[e]:[]},p.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.groupDic[e]||!t||0==t.length)return!1;for(var i=this.groupDic,a=[],s=t.length,n=0;s>n;n++){var o=t[n],u=i[o];if(u)for(var c=u.length,l=0;c>l;l++){var h=u[l];-1==a.indexOf(h)&&a.push(h)}else h=this.keyMap[o],h?-1==a.indexOf(h)&&a.push(h):egret.$warn(2e3,o)}return 0==a.length?!1:(this.groupDic[e]=a,!0)},p.parseConfig=function(e,t){if(e){var r=e.resources;if(r)for(var i=r.length,a=0;i>a;a++){var s=r[a],n=s.url;n&&-1==n.indexOf("://")&&(s.url=t+n),this.addItemToKeyMap(s)}var o=e.groups;if(o)for(i=o.length,a=0;i>a;a++){for(var u=o[a],c=[],l=u.keys.split(","),h=l.length,p=0;h>p;p++){var d=l[p].trim();s=this.keyMap[d],s&&-1==c.indexOf(s)&&c.push(s)}this.groupDic[u.name]=c}}},p.addSubkey=function(e,t){var r=this.keyMap[t];r&&!this.keyMap[e]&&(this.keyMap[e]=r)},p.addItemToKeyMap=function(e){if(this.keyMap[e.name]||(this.keyMap[e.name]=e),e.hasOwnProperty("subkeys")){var t=e.subkeys.split(",");e.subkeys=t;for(var r=t.length,i=0;r>i;i++){var a=t[i];null==this.keyMap[a]&&(this.keyMap[a]=e)}}},p.getName=function(e){var t=this.keyMap[e];return t?t.name:""},p.getType=function(e){var t=this.keyMap[e];return t?t.type:""},p.getRawResourceItem=function(e){return this.keyMap[e]},p.getResourceItem=function(e){var t=this.keyMap[e];return t?this.parseResourceItem(t):null},p.parseResourceItem=function(t){var r=new e.ResourceItem(t.name,t.url,t.type);return r.data=t,r},t}();e.ResourceConfig=t,egret.registerClass(t,"RES.ResourceConfig")}(RES||(RES={}));var RES;!function(e){var t=function(){function e(e,t,r){this.groupName="",this.data=null,this._loaded=!1,this.name=e,this.url=t,this.type=r}var t=__define,r=e;return p=r.prototype,t(p,"loaded",function(){return this.data?this.data.loaded:this._loaded},function(e){this.data&&(this.data.loaded=e),this._loaded=e}),p.toString=function(){return'[ResourceItem name="'+this.name+'" url="'+this.url+'" type="'+this.type+'"]'},e.TYPE_XML="xml",e.TYPE_IMAGE="image",e.TYPE_BIN="bin",e.TYPE_TEXT="text",e.TYPE_JSON="json",e.TYPE_SHEET="sheet",e.TYPE_FONT="font",e.TYPE_SOUND="sound",e}();e.ResourceItem=t,egret.registerClass(t,"RES.ResourceItem")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.thread=2,this.loadingCount=0,this.callBack=null,this.resInstance=null,this.groupTotalDic={},this.numLoadedDic={},this.itemListDic={},this.groupErrorDic={},this.retryTimesDic={},this.maxRetryTimes=3,this.failedList=new Array,this.priorityQueue={},this.lazyLoadList=new Array,this.analyzerDic={},this.queueIndex=0}__extends(r,t);var i=r;return p=i.prototype,p.isGroupInLoading=function(e){return void 0!==this.itemListDic[e]},p.loadGroup=function(t,r,i){if(void 0===i&&(i=0),!this.itemListDic[r]&&r){if(!t||0==t.length){egret.$warn(2001,r);var a=new e.ResourceEvent(e.ResourceEvent.GROUP_LOAD_ERROR);return a.groupName=r,void this.dispatchEvent(a)}this.priorityQueue[i]?this.priorityQueue[i].push(r):this.priorityQueue[i]=[r],this.itemListDic[r]=t;for(var s=t.length,n=0;s>n;n++){var o=t[n];o.groupName=r}this.groupTotalDic[r]=t.length,this.numLoadedDic[r]=0,this.next()}},p.loadItem=function(e){this.lazyLoadList.push(e),e.groupName="",this.next()},p.next=function(){for(;this.loadingCount<this.thread;){var t=this.getOneResourceItem();if(!t)break;if(this.loadingCount++,t.loaded)this.onItemComplete(t);else{var r=this.analyzerDic[t.type];r||(r=this.analyzerDic[t.type]=egret.Injector.getInstance(e.AnalyzerBase,t.type)),r.loadFile(t,this.onItemComplete,this)}}},p.getOneResourceItem=function(){if(this.failedList.length>0)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var t in this.priorityQueue)e=Math.max(e,t);var r=this.priorityQueue[e];if(!r||0==r.length)return 0==this.lazyLoadList.length?null:this.lazyLoadList.pop();for(var i,a=r.length,s=0;a>s&&(this.queueIndex>=a&&(this.queueIndex=0),i=this.itemListDic[r[this.queueIndex]],!(i.length>0));s++)this.queueIndex++;return 0==i.length?null:i.shift()},p.onItemComplete=function(t){this.loadingCount--;var r=t.groupName;if(!t.loaded){var i=this.retryTimesDic[t.name]||1;if(!(i>this.maxRetryTimes))return this.retryTimesDic[t.name]=i+1,this.failedList.push(t),void this.next();delete this.retryTimesDic[t.name],e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.ITEM_LOAD_ERROR,r,t)}if(r){this.numLoadedDic[r]++;var a=this.numLoadedDic[r],s=this.groupTotalDic[r];if(t.loaded||(this.groupErrorDic[r]=!0),e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.GROUP_PROGRESS,r,t,a,s),a==s){var n=this.groupErrorDic[r];this.removeGroupName(r),delete this.groupTotalDic[r],delete this.numLoadedDic[r],delete this.itemListDic[r],delete this.groupErrorDic[r],n?e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_LOAD_ERROR,r):e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,r)}}else this.callBack.call(this.resInstance,t);this.next()},p.removeGroupName=function(e){for(var t in this.priorityQueue){for(var r=this.priorityQueue[t],i=r.length,a=0,s=!1,i=r.length,n=0;i>n;n++){var o=r[n];if(o==e){r.splice(a,1),s=!0;break}a++}if(s){0==r.length&&delete this.priorityQueue[t];break}}},r}(egret.EventDispatcher);e.ResourceLoader=t,egret.registerClass(t,"RES.ResourceLoader")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),e.call(this,t,r,i),this.itemsLoaded=0,this.itemsTotal=0,this.groupName="",this.resItem=null}__extends(t,e);var r=t;return p=r.prototype,t.dispatchResourceEvent=function(e,r,i,a,s,n){void 0===i&&(i=""),void 0===a&&(a=null),void 0===s&&(s=0),void 0===n&&(n=0);var o=egret.Event.create(t,r);o.groupName=i,o.resItem=a,o.itemsLoaded=s,o.itemsTotal=n;var u=e.dispatchEvent(o);return egret.Event.release(o),u},t.ITEM_LOAD_ERROR="itemLoadError",t.CONFIG_COMPLETE="configComplete",t.CONFIG_LOAD_ERROR="configLoadError",t.GROUP_PROGRESS="groupProgress",t.GROUP_COMPLETE="groupComplete",t.GROUP_LOAD_ERROR="groupLoadError",t}(egret.Event);e.ResourceEvent=t,egret.registerClass(t,"RES.ResourceEvent")}(RES||(RES={}));var RES;!function(e){function t(e,t,r){void 0===t&&(t=""),void 0===r&&(r="json"),R.loadConfig(e,t,r)}function r(e,t){void 0===t&&(t=0),R.loadGroup(e,t)}function i(e){return R.isGroupLoaded(e)}function a(e){return R.getGroupByName(e)}function s(e,t,r){return void 0===r&&(r=!1),R.createGroup(e,t,r)}function n(e){return R.hasRes(e)}function o(e,t){void 0===t&&(t=""),R.parseConfig(e,t)}function u(e){return R.getRes(e)}function c(e,t,r){R.getResAsync(e,t,r)}function l(e,t,r,i){void 0===i&&(i=""),R.getResByUrl(e,t,r,i)}function h(e,t){return R.destroyRes(e,t)}function d(e){R.setMaxLoadingThread(e)}function f(e){R.setMaxRetryTimes(e)}function g(e,t,r,i,a){void 0===i&&(i=!1),void 0===a&&(a=0),R.addEventListener(e,t,r,i,a)}function y(e,t,r,i){void 0===i&&(i=!1),R.removeEventListener(e,t,r,i)}e.loadConfig=t,e.loadGroup=r,e.isGroupLoaded=i,e.getGroupByName=a,e.createGroup=s,e.hasRes=n,e.parseConfig=o,e.getRes=u,e.getResAsync=c,e.getResByUrl=l,e.destroyRes=h,e.setMaxLoadingThread=d,e.setMaxRetryTimes=f,e.addEventListener=g,e.removeEventListener=y;var v=function(t){function r(){t.call(this),this.analyzerDic={},this.configItemList=[],this.callLaterFlag=!1,this.configComplete=!1,this.loadedGroups=[],this.groupNameList=[],this.asyncDic={},this._loadedUrlTypes={},this.init()}__extends(r,t);var i=r;return p=i.prototype,p.getAnalyzerByType=function(t){var r=this.analyzerDic[t];return r||(r=this.analyzerDic[t]=egret.Injector.getInstance(e.AnalyzerBase,t)),r},p.init=function(){egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_BIN)||egret.Injector.mapClass(e.AnalyzerBase,e.BinAnalyzer,e.ResourceItem.TYPE_BIN),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_IMAGE)||egret.Injector.mapClass(e.AnalyzerBase,e.ImageAnalyzer,e.ResourceItem.TYPE_IMAGE),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_TEXT)||egret.Injector.mapClass(e.AnalyzerBase,e.TextAnalyzer,e.ResourceItem.TYPE_TEXT),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_JSON)||egret.Injector.mapClass(e.AnalyzerBase,e.JsonAnalyzer,e.ResourceItem.TYPE_JSON),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_SHEET)||egret.Injector.mapClass(e.AnalyzerBase,e.SheetAnalyzer,e.ResourceItem.TYPE_SHEET),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_FONT)||egret.Injector.mapClass(e.AnalyzerBase,e.FontAnalyzer,e.ResourceItem.TYPE_FONT),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_SOUND)||egret.Injector.mapClass(e.AnalyzerBase,e.SoundAnalyzer,e.ResourceItem.TYPE_SOUND),egret.Injector.hasMapRule(e.AnalyzerBase,e.ResourceItem.TYPE_XML)||egret.Injector.mapClass(e.AnalyzerBase,e.XMLAnalyzer,e.ResourceItem.TYPE_XML),this.resConfig=new e.ResourceConfig,this.resLoader=new e.ResourceLoader,this.resLoader.callBack=this.onResourceItemComp,this.resLoader.resInstance=this,this.resLoader.addEventListener(e.ResourceEvent.GROUP_COMPLETE,this.onGroupComp,this),this.resLoader.addEventListener(e.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupError,this)},p.loadConfig=function(e,t,r){void 0===r&&(r="json");var i={url:e,resourceRoot:t,type:r};this.configItemList.push(i),this.callLaterFlag||(egret.callLater(this.startLoadConfig,this),this.callLaterFlag=!0)},p.startLoadConfig=function(){this.callLaterFlag=!1;var t=this.configItemList;this.configItemList=[],this.loadingConfigList=t;for(var i=t.length,a=[],s=0;i>s;s++){var n=t[s],o=new e.ResourceItem(n.url,n.url,n.type);a.push(o)}this.resLoader.loadGroup(a,r.GROUP_CONFIG,Number.MAX_VALUE)},p.isGroupLoaded=function(e){return-1!=this.loadedGroups.indexOf(e)},p.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},p.loadGroup=function(t,r){if(void 0===r&&(r=0),-1!=this.loadedGroups.indexOf(t))return void e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,t);if(!this.resLoader.isGroupInLoading(t))if(this.configComplete){var i=this.resConfig.getGroupByName(t);this.resLoader.loadGroup(i,t,r)}else this.groupNameList.push({name:t,priority:r})},p.createGroup=function(e,t,r){if(void 0===r&&(r=!1),r){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1)}return this.resConfig.createGroup(e,t,r)},p.onGroupComp=function(t){if(t.groupName==r.GROUP_CONFIG){for(var i=this.loadingConfigList.length,a=0;i>a;a++){var s=this.loadingConfigList[a],n=this.getAnalyzerByType(s.type),o=n.getRes(s.url);n.destroyRes(s.url),this.resConfig.parseConfig(o,s.resourceRoot)}this.configComplete=!0,this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_COMPLETE),this.loadDelayGroups()}else this.loadedGroups.push(t.groupName),this.dispatchEvent(t)},p.loadDelayGroups=function(){var e=this.groupNameList;this.groupNameList=[];for(var t=e.length,r=0;t>r;r++){var i=e[r];this.loadGroup(i.name,i.priority)}},p.onGroupError=function(t){t.groupName==r.GROUP_CONFIG?(this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_LOAD_ERROR)):this.dispatchEvent(t)},p.hasRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.resConfig.getType(i),""==r)return!1}return!0},p.parseConfig=function(e,t){this.resConfig.parseConfig(e,t),this.configComplete||this.loadingConfigList||(this.configComplete=!0,this.loadDelayGroups())},p.getRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.resConfig.getType(i),""==r)return null}var a=this.getAnalyzerByType(r);return a.getRes(t)},p.getResAsync=function(t,r,i){var a=this.resConfig.getType(t),s=this.resConfig.getName(t);if(""==a&&(s=e.AnalyzerBase.getStringPrefix(t),a=this.resConfig.getType(s),""==a))return void egret.$callAsync(r,i);var n=this.getAnalyzerByType(a),o=n.getRes(t);if(o)return void egret.$callAsync(r,i,o,t);var u={key:t,compFunc:r,thisObject:i};if(this.asyncDic[s])this.asyncDic[s].push(u);else{this.asyncDic[s]=[u];var c=this.resConfig.getResourceItem(s);this.resLoader.loadItem(c)}},p.getResByUrl=function(t,r,i,a){if(void 0===a&&(a=""),!t)return void egret.$callAsync(r,i);a||(a=this.getTypeByUrl(t)),null!=this._loadedUrlTypes[t]&&this._loadedUrlTypes[t]!=a&&egret.$warn(2002),this._loadedUrlTypes[t]=a;var s=this.getAnalyzerByType(a),n=t,o=s.getRes(n);if(o)return void egret.$callAsync(r,i,o,t);var u={key:n,compFunc:r,thisObject:i};if(this.asyncDic[n])this.asyncDic[n].push(u);else{this.asyncDic[n]=[u];var c=new e.ResourceItem(n,t,a);this.resLoader.loadItem(c)}},p.getTypeByUrl=function(t){var r=t.substr(t.lastIndexOf(".")+1);r&&(r=r.toLowerCase());var i;switch(r){case e.ResourceItem.TYPE_XML:case e.ResourceItem.TYPE_JSON:case e.ResourceItem.TYPE_SHEET:i=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":i=e.ResourceItem.TYPE_IMAGE;break;case"fnt":i=e.ResourceItem.TYPE_FONT;break;case"txt":i=e.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":i=e.ResourceItem.TYPE_SOUND;break;default:i=e.ResourceItem.TYPE_BIN}return i},p.onResourceItemComp=function(e){var t=this.asyncDic[e.name];delete this.asyncDic[e.name];for(var r=this.getAnalyzerByType(e.type),i=t.length,a=0;i>a;a++){var s=t[a],n=r.getRes(s.key);s.compFunc.call(s.thisObject,n,s.key)}},p.destroyRes=function(e,t){void 0===t&&(t=!0);var r=this.resConfig.getRawGroupByName(e);if(r&&r.length>0){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1);for(var a=r.length,s=0;a>s;s++){var n=r[s];if(!t&&this.isResInLoadedGroup(n.name));else{n.loaded=!1;var o=this.getAnalyzerByType(n.type);o.destroyRes(n.name),this.removeLoadedGroupsByItemName(n.name)}}return!0}var u=this.resConfig.getType(e);if(""==u){if(u=this._loadedUrlTypes[e],null==u||""==u)return!1;delete this._loadedUrlTypes[e];var o=this.getAnalyzerByType(u);return o.destroyRes(e),!0}n=this.resConfig.getRawResourceItem(e),n.loaded=!1,o=this.getAnalyzerByType(u);var c=o.destroyRes(e);return this.removeLoadedGroupsByItemName(n.name),c},p.removeLoadedGroupsByItemName=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var a=this.resConfig.getRawGroupByName(t[i]),s=a.length,n=0;s>n;n++){var o=a[n];if(o.name==e){t.splice(i,1),i--,r=t.length;break}}},p.isResInLoadedGroup=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var a=this.resConfig.getRawGroupByName(t[i]),s=a.length,n=0;s>n;n++){var o=a[n];if(o.name==e)return!0}return!1},p.setMaxLoadingThread=function(e){1>e&&(e=1),this.resLoader.thread=e},p.setMaxRetryTimes=function(e){e=Math.max(e,0),this.resLoader.maxRetryTimes=e},r.GROUP_CONFIG="RES__CONFIG",r}(egret.EventDispatcher);egret.registerClass(v,"Resource");var R=new v}(RES||(RES={}));