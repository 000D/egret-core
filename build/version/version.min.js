var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__define=this.__define||function(e,t,n,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n,set:r})},egret;!function(e){var t=function(t){function n(){t.call(this),this.addEventListener(e.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(n,t);var r=n;return p=r.prototype,p.onAddToStage=function(){this.textField=new e.TextField,this.addChild(this.textField),this.textField.width=this.stage.stageWidth,this.textField.y=this.stage.stageHeight/2,this.textField.size=20,this.textField.textAlign="center"},p.setProgress=function(e,t){console.log("egret_native  "+Math.round(e/1024)+"KB / "+Math.round(t/1024)+"KB"),this.textField.text="Loading Resource..."+Math.round(e/1024)+"KB / "+Math.round(t/1024)+"KB"},p.loadError=function(){this.textField.text="Resource loading failed，please check the network connection and exit back into the game！"},n}(e.DisplayObjectContainer);e.DefaultLoadingView=t,e.registerClass(t,"egret.DefaultLoadingView",["egret.ILoadingView"])}(egret||(egret={}));var egret;!function(e){e.VersionController}(egret||(egret={}));var egret;!function(e){var t;!function(t){var n=function(t){function n(e){t.call(this),this._versionInfo={},this._versionPath="",this._localFileArr=[],this._stage=e}__extends(n,t);var r=n;return p=r.prototype,p.fetchVersion=function(){var t=this;if(t._versionPath="all.manifest",t._versionInfo=t.getLocalData(t._versionPath),null==t._versionInfo)return void e.callLater(function(){t.dispatchEvent(new e.IOErrorEvent(e.IOErrorEvent.IO_ERROR))},t);var n=0,r=function(r){if(r)for(var i=0;i<r.length;i++)r[i]&&""!=r[i]&&t._localFileArr.push("resource/"+r[i]);n++,2==n&&("native"==egret_native.nativeType?t.loadAllChange():t.dispatchEvent(new e.Event(e.Event.COMPLETE)))};t.getList(r,"assets","resource"),t.getList(r,"update","resource")},p.getList=function(t,n,r){void 0===r&&(r="");var i=e.PromiseObject.create();i.onSuccessFunc=function(e){t(e)},i.onErrorFunc=function(){console.error("list files error")},"assets"==n?egret_native.Game.listResource(r,i):egret_native.Game.listUpdate(r,i)},p.checkIsNewVersion=function(e){return egret_native.isFileExists(e)},p.saveVersion=function(){},p.getChangeList=function(){var e=[],t=this._localFileArr;for(var n in this._versionInfo)t.indexOf(this.getVirtualUrl(n))<0&&e.push({url:this.getVirtualUrl(n),size:this._versionInfo[n].s});return e},p.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s:e},p.loadAllChange=function(){function t(){s.length>0?v.load(s[0].url,s[0].size):l>3?(v.removeEventListener(e.IOErrorEvent.IO_ERROR,i,o),v.removeEventListener(e.Event.COMPLETE,n,o),v.removeEventListener(e.ProgressEvent.PROGRESS,r,o),o._iLoadingView.loadError(),e.IOErrorEvent.dispatchIOErrorEvent(o)):a.length>0?(s=a,a=[],l++,n()):(v.removeEventListener(e.IOErrorEvent.IO_ERROR,i,o),v.removeEventListener(e.Event.COMPLETE,n,o),v.removeEventListener(e.ProgressEvent.PROGRESS,r,o),o._stage.removeChild(o._iLoadingView),o.dispatchEvent(new e.Event(e.Event.COMPLETE)))}function n(){c+=parseInt(s[0].size),s.shift(),t()}function r(e){o._iLoadingView.setProgress(c+e.bytesLoaded,u)}function i(){a.push(s[0]),s.shift(),n()}var o=this;null==o._iLoadingView&&(o._iLoadingView=new e.DefaultLoadingView),o._stage.addChild(o._iLoadingView);var s=this.getChangeList(),a=[],l=0,o=this,v=new e.NativeResourceLoader;v.addEventListener(e.IOErrorEvent.IO_ERROR,i,o),v.addEventListener(e.Event.COMPLETE,n,o),v.addEventListener(e.ProgressEvent.PROGRESS,r,o);var c=0,u=0;for(var g in s)u+=s[g].size;t()},p.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var t=egret_native.readUpdateFileSync(e);return null!=t?JSON.parse(t):(t=egret_native.readResourceFileSync(e),null!=t?JSON.parse(t):null)}return this.getLocalDataByOld(e)},p.getLocalDataByOld=function(e){var t=null;if(egret_native.isRecordExists(e)){var n=egret_native.loadRecord(e);t=JSON.parse(n)}else if(egret_native.isFileExists(e)){var n=egret_native.readFileSync(e);t=JSON.parse(n)}return t},n}(e.EventDispatcher);t.NativeVersionController=n,e.registerClass(n,"egret.native.NativeVersionController",["egret.VersionController","egret.IVersionController","egret.IEventDispatcher"]),e.Capabilities.runtimeType==e.RuntimeType.NATIVE&&(e.VersionController=n)}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this),this._versionInfo={}}__extends(n,t);var r=n;return p=r.prototype,p.fetchVersion=function(){var t=this;t.dispatchEvent(new e.Event(e.Event.COMPLETE))},p.checkIsNewVersion=function(){return!1},p.saveVersion=function(){},p.getChangeList=function(){return[]},p.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s:e},n}(e.EventDispatcher);t.Html5VersionController=n,e.registerClass(n,"egret.web.Html5VersionController",["egret.VersionController","egret.IVersionController","egret.IEventDispatcher"]),e.Capabilities.runtimeType==e.RuntimeType.WEB&&(e.VersionController=n)}(t=e.web||(e.web={}))}(egret||(egret={}));